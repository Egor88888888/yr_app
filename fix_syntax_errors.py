#!/usr/bin/env python3
"""
–°–∫—Ä–∏–ø—Ç –¥–ª—è –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Å–∏–Ω—Ç–∞–∫—Å–∏—á–µ—Å–∫–∏—Ö –æ—à–∏–±–æ–∫ —Å —ç–º–æ–¥–∑–∏ –≤ bot/main.py
"""

import re


def fix_syntax_errors():
    """–ò—Å–ø—Ä–∞–≤–ª—è–µ—Ç –≤—Å–µ —Å–∏–Ω—Ç–∞–∫—Å–∏—á–µ—Å–∫–∏–µ –æ—à–∏–±–∫–∏ —Å —ç–º–æ–¥–∑–∏"""
    print("üîß –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–∏–Ω—Ç–∞–∫—Å–∏—á–µ—Å–∫–∏—Ö –æ—à–∏–±–æ–∫...")

    # –ß–∏—Ç–∞–µ–º —Ñ–∞–π–ª
    try:
        with open('bot/main.py', 'r', encoding='utf-8') as f:
            lines = f.readlines()
    except Exception as e:
        print(f"‚ùå –û—à–∏–±–∫–∞ —á—Ç–µ–Ω–∏—è —Ñ–∞–π–ª–∞: {e}")
        return False

    # –ü—Ä–æ–±–ª–µ–º–Ω—ã–µ —Å—Ç—Ä–æ–∫–∏ –∫–æ—Ç–æ—Ä—ã–µ –Ω—É–∂–Ω–æ –∑–∞–∫–æ–º–º–µ–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å
    problem_line_numbers = [3, 296, 5543]  # –û—Å–Ω–æ–≤–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º–Ω—ã–µ —Å—Ç—Ä–æ–∫–∏

    fixed_count = 0

    # –ò—Å–ø—Ä–∞–≤–ª—è–µ–º –∫–∞–∂–¥—É—é —Å—Ç—Ä–æ–∫—É
    for i, line in enumerate(lines):
        line_num = i + 1
        original_line = line

        # –ü—Ä–æ–≤–µ—Ä—è–µ–º –ø—Ä–æ–±–ª–µ–º–Ω—ã–µ —Å—Ç—Ä–æ–∫–∏ –ø–æ –Ω–æ–º–µ—Ä–∞–º
        if line_num in problem_line_numbers:
            if not line.strip().startswith('#') and 'üèõ' in line:
                # –ó–∞–∫–æ–º–º–µ–Ω—Ç–∏—Ä—É–µ–º —Å—Ç—Ä–æ–∫—É
                lines[i] = f"# {line}"
                print(f"Line {line_num}: –ó–∞–∫–æ–º–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∞")
                fixed_count += 1

        # –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞: –∏—â–µ–º —Å—Ç—Ä–æ–∫–∏ —Å —ç–º–æ–¥–∑–∏ –≤–Ω–µ —Å—Ç—Ä–æ–∫
        elif 'üèõ' in line:
            # –ü—Ä–æ–≤–µ—Ä—è–µ–º, –µ—Å–ª–∏ —ç—Ç–æ –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ –ø—Ä–æ–±–ª–µ–º–Ω–∞—è —Å—Ç—Ä–æ–∫–∞
            clean_line = line.strip()

            # –ü—Ä–æ–ø—É—Å–∫–∞–µ–º –µ—Å–ª–∏ —ç—Ç–æ —É–∂–µ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π
            if clean_line.startswith('#'):
                continue

            # –ü—Ä–æ–ø—É—Å–∫–∞–µ–º –µ—Å–ª–∏ —ç—Ç–æ –≤ docstring
            if clean_line.startswith('"""') or clean_line.startswith("'''"):
                continue

            # –ü—Ä–æ–ø—É—Å–∫–∞–µ–º –µ—Å–ª–∏ —ç—Ç–æ —è–≤–Ω–æ –≤ —Å—Ç—Ä–æ–∫–µ
            if (('f"""' in line or 'f"' in line or "f'" in line or
                 '"""' in line or '"' in line or "'" in line) and
                    ('üèõ' in line)):
                continue

            # –ï—Å–ª–∏ –¥–æ—à–ª–∏ —Å—é–¥–∞, –≤–æ–∑–º–æ–∂–Ω–æ —ç—Ç–æ –ø—Ä–æ–±–ª–µ–º–Ω–∞—è —Å—Ç—Ä–æ–∫–∞
            # –ü–æ–ø—Ä–æ–±—É–µ–º –æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏
            # –£–±–∏—Ä–∞–µ–º —Å—Ç—Ä–æ–∫–∏ –≤ –∫–∞–≤—ã—á–∫–∞—Ö
            test_line = re.sub(r'["\'].*?["\']', '', line)
            if 'üèõ' in test_line and not test_line.strip().startswith('#'):
                # –≠—Ç–æ –ø—Ä–æ–±–ª–µ–º–Ω–∞—è —Å—Ç—Ä–æ–∫–∞ - –∑–∞–∫–æ–º–º–µ–Ω—Ç–∏—Ä—É–µ–º
                lines[i] = f"# {line}"
                print(f"Line {line_num}: –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∑–∞–∫–æ–º–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∞")
                fixed_count += 1

    # –ó–∞–ø–∏—Å—ã–≤–∞–µ–º –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–π —Ñ–∞–π–ª
    try:
        with open('bot/main.py', 'w', encoding='utf-8') as f:
            f.writelines(lines)
        print(f"‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ {fixed_count} —Å—Ç—Ä–æ–∫!")
        return True
    except Exception as e:
        print(f"‚ùå –û—à–∏–±–∫–∞ –∑–∞–ø–∏—Å–∏ —Ñ–∞–π–ª–∞: {e}")
        return False


if __name__ == "__main__":
    fix_syntax_errors()
