<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no, maximum-scale=1.0">
    <meta http-equiv="cache-control" content="no-cache">
    <meta http-equiv="expires" content="0">
    <meta http-equiv="pragma" content="no-cache">
    <title>–°—Ç—Ä–∞—Ö–æ–≤–∞—è —Å–ø—Ä–∞–≤–µ–¥–ª–∏–≤–æ—Å—Ç—å</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <script src="https://unpkg.com/lucide@latest/dist/umd/lucide.min.js"></script>
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&display=swap" rel="stylesheet">
    
    <style>
        :root {
            --tg-theme-bg-color: var(--tg-theme-bg-color, #ffffff);
            --tg-theme-text-color: var(--tg-theme-text-color, #222222);
            --tg-theme-hint-color: var(--tg-theme-hint-color, #999999);
            --tg-theme-link-color: var(--tg-theme-link-color, #007aff);
            --tg-theme-button-color: var(--tg-theme-button-color, #007aff);
            --tg-theme-button-text-color: var(--tg-theme-button-text-color, #ffffff);
            --tg-theme-secondary-bg-color: var(--tg-theme-secondary-bg-color, #f8fafc);
            
            /* –î–æ–±–∞–≤–ª—è–µ–º –∫–∞—Å—Ç–æ–º–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –¥–ª—è —É–ª—É—á—à–µ–Ω–Ω–æ–≥–æ –¥–∏–∑–∞–π–Ω–∞ */
            --primary-gradient: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            --success-gradient: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            --card-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
            --card-shadow-hover: 0 20px 40px -5px rgba(0, 0, 0, 0.15), 0 8px 12px -2px rgba(0, 0, 0, 0.1);
        }
        
        * { box-sizing: border-box; }
        
        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            color: var(--tg-theme-text-color);
            margin: 0; padding: 0;
            overscroll-behavior: none;
            font-feature-settings: 'kern' 1;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }
        
        .page-container {
            position: relative; width: 100vw; height: 100vh; overflow: hidden;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }

        .page {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            padding: 24px; padding-bottom: 100px;
            transition: all 0.5s cubic-bezier(0.25, 0.8, 0.25, 1);
            overflow-y: auto; 
            background: var(--tg-theme-bg-color);
            box-sizing: border-box;
            visibility: hidden;
            border-radius: 20px 20px 0 0;
            margin-top: 60px;
            box-shadow: 0 -10px 30px rgba(0,0,0,0.1);
        }

        .page.active { visibility: visible; }
        .page.left { transform: translateX(-100%) scale(0.95); opacity: 0; }
        .page.center { transform: translateX(0) scale(1); opacity: 1; }
        .page.right { transform: translateX(100%) scale(0.95); opacity: 0; }
        
        /* –≠–ª–µ–≥–∞–Ω—Ç–Ω—ã–µ –∑–∞–≥–æ–ª–æ–≤–∫–∏ */
        .page-header {
            position: absolute;
            top: 0; left: 0; right: 0;
            background: var(--primary-gradient);
            color: white;
            padding: 20px 24px;
            z-index: 10;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
        }
        
        .service-card {
            background: var(--tg-theme-secondary-bg-color);
            border: 2px solid transparent;
            border-radius: 20px;
            transition: all 0.3s cubic-bezier(0.25, 0.8, 0.25, 1);
            box-shadow: var(--card-shadow);
            backdrop-filter: blur(10px);
            position: relative;
            overflow: hidden;
        }
        
        .service-card::before {
            content: '';
            position: absolute;
            top: 0; left: 0; right: 0; bottom: 0;
            background: linear-gradient(135deg, rgba(102, 126, 234, 0.1), rgba(118, 75, 162, 0.1));
            opacity: 0;
            transition: opacity 0.3s ease;
        }
        
        .service-card.selected {
            border-color: var(--tg-theme-button-color);
            transform: translateY(-4px) scale(1.02);
            box-shadow: var(--card-shadow-hover);
        }
        
        .service-card.selected::before {
            opacity: 1;
        }
        
        .service-card:hover { 
            transform: translateY(-3px) scale(1.01); 
            box-shadow: var(--card-shadow-hover);
        }
        
        .service-card .icon-container {
            background: var(--primary-gradient);
            color: white;
            border-radius: 16px;
            width: 48px;
            height: 48px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 12px;
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);
        }

        .form-input {
            width: 100%; 
            padding: 16px 20px; 
            border-radius: 16px;
            border: 2px solid rgba(255,255,255,0.2);
            background: rgba(255,255,255,0.95);
            backdrop-filter: blur(10px);
            color: var(--tg-theme-text-color); 
            font-size: 16px;
            font-weight: 500;
            transition: all 0.3s cubic-bezier(0.25, 0.8, 0.25, 1);
            box-shadow: 0 4px 15px rgba(0,0,0,0.05);
        }
        
        .form-input::placeholder { 
            color: var(--tg-theme-hint-color); 
            font-weight: 400;
        }
        
        .form-input:focus { 
            outline: none; 
            border-color: var(--tg-theme-button-color);
            box-shadow: 0 0 0 4px rgba(0, 122, 255, 0.1), 0 8px 25px rgba(0,0,0,0.1);
            transform: translateY(-2px);
        }
        
        .form-input.invalid { 
            border-color: #ef4444;
            box-shadow: 0 0 0 4px rgba(239, 68, 68, 0.1);
        }
        
        .progress-bar {
            background: rgba(255,255,255,0.2);
            border-radius: 10px;
            overflow: hidden;
            backdrop-filter: blur(10px);
        }
        
        .progress-bar-fill {
            background: var(--primary-gradient);
            transition: width 0.6s cubic-bezier(0.25, 0.8, 0.25, 1);
            box-shadow: 0 0 20px rgba(102, 126, 234, 0.5);
        }
        
        /* –ê–Ω–∏–º–∞—Ü–∏–∏ –ø–æ—è–≤–ª–µ–Ω–∏—è */
        @keyframes slideInUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }
        
        .animate-slide-up {
            animation: slideInUp 0.6s cubic-bezier(0.25, 0.8, 0.25, 1) forwards;
        }
        
        .animate-pulse-gentle {
            animation: pulse 2s infinite;
        }
        
        /* –£–ª—É—á—à–µ–Ω–Ω—ã–µ –ª–µ–π–±–ª—ã */
        .form-label {
            color: var(--tg-theme-text-color);
            font-weight: 600;
            font-size: 14px;
            margin-bottom: 8px;
            display: block;
            position: relative;
        }
        
        .form-label::before {
            content: '';
            position: absolute;
            left: -12px;
            top: 50%;
            transform: translateY(-50%);
            width: 3px;
            height: 12px;
            background: var(--primary-gradient);
            border-radius: 2px;
        }
        
        /* –°—Ç–∏–ª–∏–∑–∞—Ü–∏—è –¥–ª—è —Å—Ç—Ä–∞–Ω–∏—Ü—ã —É—Å–ø–µ—Ö–∞ */
        .success-container {
            background: var(--primary-gradient);
            border-radius: 24px;
            padding: 32px;
            text-align: center;
            color: white;
            box-shadow: var(--card-shadow-hover);
        }
        
        .success-icon {
            width: 80px;
            height: 80px;
            background: rgba(255,255,255,0.2);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 24px;
            backdrop-filter: blur(10px);
        }
        
        /* Responsive –∞–¥–∞–ø—Ç–∞—Ü–∏—è */
        @media (max-width: 375px) {
            .page { padding: 20px; padding-bottom: 90px; }
            .service-card .icon-container { width: 40px; height: 40px; }
            .form-input { padding: 14px 16px; font-size: 15px; }
        }
        
        /* –¢–µ–º–Ω–∞—è —Ç–µ–º–∞ */
        @media (prefers-color-scheme: dark) {
            :root {
                --tg-theme-secondary-bg-color: rgba(255,255,255,0.05);
            }
            
            .form-input {
                background: rgba(255,255,255,0.1);
                border-color: rgba(255,255,255,0.1);
            }
        }
    </style>
</head>
<body>

<div class="page-container">
    <!-- –ó–∞–≥–æ–ª–æ–≤–æ–∫ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è -->
    <div class="page-header">
        <h1 class="text-2xl font-bold text-center">‚öñÔ∏è –°—Ç—Ä–∞—Ö–æ–≤–∞—è —Å–ø—Ä–∞–≤–µ–¥–ª–∏–≤–æ—Å—Ç—å</h1>
        <p class="text-center text-sm opacity-90 mt-1">–ü—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω–∞—è –ø–æ–º–æ—â—å –ø–æ —Å—Ç—Ä–∞—Ö–æ–≤—ã–º –≤—ã–ø–ª–∞—Ç–∞–º</p>
    </div>

    <div id="page-problems" class="page active center">
        <header class="text-center mb-8 animate-slide-up">
            <h2 class="text-2xl font-bold mb-3">–ß—Ç–æ —É –≤–∞—Å —Å–ª—É—á–∏–ª–æ—Å—å?</h2>
            <p class="text-sm text-gray-600">–í—ã–±–µ—Ä–∏—Ç–µ –≤–∞—à—É —Å–∏—Ç—É–∞—Ü–∏—é –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –ø–µ—Ä—Å–æ–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–æ–π –ø–æ–º–æ—â–∏</p>
        </header>
        
        <div class="progress-bar w-full h-3 rounded-full mb-8">
            <div class="progress-bar-fill h-full rounded-full" style="width: 25%;"></div>
        </div>
        
        <div id="services-grid" class="grid grid-cols-2 gap-4 animate-slide-up" style="animation-delay: 0.2s;"></div>
        
        <!-- –î–æ–±–∞–≤–ª—è–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –∫–æ–º–ø–∞–Ω–∏–∏ -->
        <div class="mt-8 p-4 bg-white bg-opacity-50 rounded-2xl backdrop-blur-sm animate-slide-up" style="animation-delay: 0.4s;">
            <p class="text-xs text-center text-gray-600">
                ‚ú® <strong>95% —É—Å–ø–µ—à–Ω—ã—Ö –¥–µ–ª</strong> ‚Ä¢ üí∞ <strong>–û–ø–ª–∞—Ç–∞ –ø–æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—É</strong> ‚Ä¢ ‚öñÔ∏è <strong>–û–ø—ã—Ç 5+ –ª–µ—Ç</strong>
            </p>
        </div>
    </div>

    <div id="page-details" class="page right">
         <div id="details-content"></div>
    </div>

    <div id="page-contacts" class="page right">
        <div class="animate-slide-up">
            <h2 class="text-2xl font-bold mb-3">–ö–æ–Ω—Ç–∞–∫—Ç–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ</h2>
            <p class="text-sm text-gray-600 mb-8">–£–∫–∞–∂–∏—Ç–µ, –∫–∞–∫ —Å –≤–∞–º–∏ —Å–≤—è–∑–∞—Ç—å—Å—è –¥–ª—è –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏–∏</p>
            
            <div class="progress-bar w-full h-3 rounded-full mb-8">
                <div class="progress-bar-fill h-full rounded-full" style="width: 50%;"></div>
            </div>
            
            <div class="space-y-6">
                <div>
                    <label for="name" class="form-label">üë§ –í–∞—à–µ –∏–º—è</label>
                    <input type="text" id="name" class="form-input" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: –ò–≤–∞–Ω –ü–µ—Ç—Ä–æ–≤">
                </div>
                <div>
                    <label for="phone" class="form-label">üìû –ù–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞</label>
                    <input type="tel" id="phone" class="form-input" placeholder="+7 (999) 123-45-67">
                </div>
            </div>
            
            <!-- –î–æ–±–∞–≤–ª—è–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ -->
            <div class="mt-8 p-4 bg-blue-50 bg-opacity-50 rounded-2xl backdrop-blur-sm">
                <p class="text-xs text-center text-gray-600">
                    üîí –í–∞—à–∏ –¥–∞–Ω–Ω—ã–µ –∑–∞—â–∏—â–µ–Ω—ã –∏ –Ω–µ –ø–µ—Ä–µ–¥–∞—é—Ç—Å—è —Ç—Ä–µ—Ç—å–∏–º –ª–∏—Ü–∞–º
                </p>
            </div>
        </div>
    </div>

    <div id="page-description" class="page right">
        <h1 class="text-2xl font-bold mb-2">–û–ø–∏—Å–∞–Ω–∏–µ —Å–∏—Ç—É–∞—Ü–∏–∏</h1>
        <p class="mb-6" style="color: var(--tg-theme-hint-color);">–û–ø–∏—à–∏—Ç–µ –≤–∞—à—É –ø—Ä–æ–±–ª–µ–º—É –∫—Ä–∞—Ç–∫–æ</p>
        <div class="progress-bar w-full h-2 rounded-full mb-6">
            <div class="progress-bar-fill h-full rounded-full" style="width: 75%;"></div>
        </div>
        <textarea id="description" class="form-input" rows="6" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: –°—Ç—Ä–∞—Ö–æ–≤–∞—è –æ—Ç–∫–∞–∑–∞–ª–∞ –≤ –≤—ã–ø–ª–∞—Ç–µ –ø–æ—Å–ª–µ –î–¢–ü..."></textarea>
    </div>

    <div id="page-summary" class="page right">
        <h1 class="text-2xl font-bold mb-2">–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∑–∞—è–≤–∫—É</h1>
        <p class="mb-6" style="color: var(--tg-theme-hint-color);">–í—Å–µ –¥–∞–Ω–Ω—ã–µ –≤–µ—Ä–Ω—ã?</p>
        <div class="progress-bar w-full h-2 rounded-full mb-6">
            <div class="progress-bar-fill h-full rounded-full" style="width: 100%;"></div>
        </div>
        <div id="summary-container" class="space-y-4"></div>
    </div>

    <div id="page-success" class="page right flex flex-col items-center justify-center text-center">
        <div class="success-container animate-slide-up">
            <div class="success-icon animate-pulse-gentle">
                <i data-lucide="check" class="w-10 h-10"></i>
            </div>
            <h2 class="text-2xl font-bold mb-4">üéâ –ó–∞—è–≤–∫–∞ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∞!</h2>
            <p class="mb-6 opacity-90">–ù–∞—à —é—Ä–∏—Å—Ç-—ç–∫—Å–ø–µ—Ä—Ç —Å–≤—è–∂–µ—Ç—Å—è —Å –≤–∞–º–∏ –≤ —Ç–µ—á–µ–Ω–∏–µ 15 –º–∏–Ω—É—Ç –¥–ª—è –±–µ—Å–ø–ª–∞—Ç–Ω–æ–π –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏–∏</p>
            
            <!-- –ß—Ç–æ –¥–∞–ª—å—à–µ */
            <div class="bg-white bg-opacity-20 rounded-2xl p-4 mb-6">
                <h3 class="font-semibold mb-3">üìã –ß—Ç–æ –±—É–¥–µ—Ç –¥–∞–ª—å—à–µ:</h3>
                <ul class="text-sm space-y-2 text-left">
                    <li>‚Ä¢ –≠–∫—Å–ø—Ä–µ—Å—Å-–∞–Ω–∞–ª–∏–∑ –≤–∞—à–µ–≥–æ –¥–µ–ª–∞</li>
                    <li>‚Ä¢ –û—Ü–µ–Ω–∫–∞ —à–∞–Ω—Å–æ–≤ –Ω–∞ —É—Å–ø–µ—Ö</li>
                    <li>‚Ä¢ –ü–ª–∞–Ω –¥–µ–π—Å—Ç–≤–∏–π –¥–ª—è –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–π –≤—ã–ø–ª–∞—Ç—ã</li>
                    <li>‚Ä¢ –û—Ç–≤–µ—Ç—ã –Ω–∞ –≤—Å–µ –≤–∞—à–∏ –≤–æ–ø—Ä–æ—Å—ã</li>
                </ul>
            </div>
            
            <div id="success-actions" class="w-full"></div>
        </div>
    </div>
</div>

<script>
    const tg = window.Telegram.WebApp;

    const services = [
        { 
            id: 'denial', title: '–û—Ç–∫–∞–∑ –≤ –≤—ã–ø–ª–∞—Ç–µ', icon: 'shield-off',
            details: '–°—Ç—Ä–∞—Ö–æ–≤—ã–µ –∫–æ–º–ø–∞–Ω–∏–∏ —á–∞—Å—Ç–æ –∏—â—É—Ç —Ñ–æ—Ä–º–∞–ª—å–Ω—ã–µ –ø–æ–≤–æ–¥—ã –¥–ª—è –æ—Ç–∫–∞–∑–∞. –ú—ã –∑–Ω–∞–µ–º –≤—Å–µ —É–ª–æ–≤–∫–∏ –∏ –ø–æ–º–æ–∂–µ–º –¥–æ–∫–∞–∑–∞—Ç—å –≤–∞—à–µ –ø—Ä–∞–≤–æ –Ω–∞ –≤—ã–ø–ª–∞—Ç—É.',
            caseLink: 'https://strahovayasprav.ru/' 
        },
        { 
            id: 'underpayment', title: '–ó–∞–Ω–∏–∂–µ–Ω–∏–µ –≤—ã–ø–ª–∞—Ç—ã', icon: 'trending-down',
            details: '–°–∞–º–∞—è —á–∞—Å—Ç–∞—è –ø—Ä–æ–±–ª–µ–º–∞. –ú—ã –æ—Ä–≥–∞–Ω–∏–∑—É–µ–º –Ω–µ–∑–∞–≤–∏—Å–∏–º—É—é —ç–∫—Å–ø–µ—Ä—Ç–∏–∑—É, –∫–æ—Ç–æ—Ä–∞—è —É—Å—Ç–∞–Ω–æ–≤–∏—Ç —Ä–µ–∞–ª—å–Ω—É—é —Å—É–º–º—É —É—â–µ—Ä–±–∞, –∏ –≤–∑—ã—â–µ–º —Ä–∞–∑–Ω–∏—Ü—É —Å–æ —Å—Ç—Ä–∞—Ö–æ–≤–æ–π.',
            caseLink: 'https://strahovayasprav.ru/'
        },
        { 
            id: 'delay', title: '–ó–∞—Ç—è–≥–∏–≤–∞–Ω–∏–µ —Å—Ä–æ–∫–æ–≤', icon: 'hourglass',
            details: '–ü–æ –∑–∞–∫–æ–Ω—É —É —Å—Ç—Ä–∞—Ö–æ–≤–æ–π –µ—Å—Ç—å 20 –¥–Ω–µ–π –Ω–∞ –≤—ã–ø–ª–∞—Ç—É. –ï—Å–ª–∏ —Å—Ä–æ–∫–∏ –Ω–∞—Ä—É—à–µ–Ω—ã, –≤—ã –∏–º–µ–µ—Ç–µ –ø—Ä–∞–≤–æ –Ω–∞ –Ω–µ—É—Å—Ç–æ–π–∫—É (1% –æ—Ç —Å—É–º–º—ã –∑–∞ –∫–∞–∂–¥—ã–π –¥–µ–Ω—å –ø—Ä–æ—Å—Ä–æ—á–∫–∏).',
            caseLink: 'https://strahovayasprav.ru/'
        },
        { 
            id: 'uts', title: '–í–∑—ã—Å–∫–∞–Ω–∏–µ –£–¢–°', icon: 'receipt',
            details: '–£—Ç—Ä–∞—Ç–∞ —Ç–æ–≤–∞—Ä–Ω–æ–π —Å—Ç–æ–∏–º–æ—Å—Ç–∏ (–£–¢–°) ‚Äì —ç—Ç–æ —É–º–µ–Ω—å—à–µ–Ω–∏–µ —Ä—ã–Ω–æ—á–Ω–æ–π —Ü–µ–Ω—ã –∞–≤—Ç–æ –ø–æ—Å–ª–µ —Ä–µ–º–æ–Ω—Ç–∞. –ï–µ –ø–æ—á—Ç–∏ –Ω–∏–∫–æ–≥–¥–∞ –Ω–µ –≤—ã–ø–ª–∞—á–∏–≤–∞—é—Ç –¥–æ–±—Ä–æ–≤–æ–ª—å–Ω–æ.',
            caseLink: 'https://strahovayasprav.ru/'
        },
        { 
            id: 'culprit', title: '–°–ø–æ—Ä —Å –≤–∏–Ω–æ–≤–Ω–∏–∫–æ–º', icon: 'users',
            details: '–ï—Å–ª–∏ –ª–∏–º–∏—Ç–∞ –ø–æ –û–°–ê–ì–û (400 —Ç—ã—Å. —Ä—É–±.) –Ω–µ —Ö–≤–∞—Ç–∏–ª–æ –Ω–∞ —Ä–µ–º–æ–Ω—Ç, —Ä–∞–∑–Ω–∏—Ü—É –º–æ–∂–Ω–æ –∏ –Ω—É–∂–Ω–æ –≤–∑—ã—Å–∫–∏–≤–∞—Ç—å –Ω–∞–ø—Ä—è–º—É—é —Å –≤–∏–Ω–æ–≤–Ω–∏–∫–∞ –î–¢–ü.',
            caseLink: 'https://strahovayasprav.ru/'
        },
        { 
            id: 'other', title: '–î—Ä—É–≥–∞—è –ø—Ä–æ–±–ª–µ–º–∞', icon: 'help-circle',
            details: '–ï—Å–ª–∏ –≤—ã –Ω–µ –Ω–∞—à–ª–∏ —Å–≤–æ—é –ø—Ä–æ–±–ª–µ–º—É –≤ —Å–ø–∏—Å–∫–µ, –ø–æ–¥—Ä–æ–±–Ω–æ –æ–ø–∏—à–∏—Ç–µ –µ–µ –Ω–∞ —Å–ª–µ–¥—É—é—â–µ–º —à–∞–≥–µ, –∏ –º—ã –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ —Ä–∞–∑–±–µ—Ä–µ–º—Å—è –∏ –ø–æ–º–æ–∂–µ–º.',
            caseLink: 'https://strahovayasprav.ru/'
        }
    ];
    let state = {
        currentPage: 'problems',
        previousPage: null,
        formData: {
            problems: new Set(),
            name: '', phone: '', description: ''
        }
    };
    const pageOrder = ['problems', 'contacts', 'description', 'summary'];

    const pages = {
        problems: document.getElementById('page-problems'),
        details: document.getElementById('page-details'),
        contacts: document.getElementById('page-contacts'),
        description: document.getElementById('page-description'),
        summary: document.getElementById('page-summary'),
        success: document.getElementById('page-success')
    };

    document.addEventListener('DOMContentLoaded', () => {
        try {
            console.log('üéØ MINI APP –ó–ê–ü–£–©–ï–ù!');
            console.log('üîó tg –æ–±—ä–µ–∫—Ç:', tg);
            tg.ready();
            tg.expand();
            console.log('‚úÖ tg.ready() –∏ tg.expand() –≤—ã–ø–æ–ª–Ω–µ–Ω—ã');
            
            if (tg.initDataUnsafe?.user) {
                const user = tg.initDataUnsafe.user;
                console.log('üë§ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–∞–π–¥–µ–Ω:', user);
                state.formData.name = `${user.first_name || ''} ${user.last_name || ''}`.trim();
                document.getElementById('name').value = state.formData.name;
            } else {
                console.log('‚ö†Ô∏è –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –Ω–∞–π–¥–µ–Ω –≤ initDataUnsafe');
            }

            renderServiceCards();
            updateUI();
            lucide.createIcons();

            document.getElementById('services-grid').addEventListener('click', handleServiceClick);
            Object.values(document.querySelectorAll('.form-input')).forEach(input => input.addEventListener('input', handleInputChange));
            tg.MainButton.onClick(handleMainButtonClick);
            tg.onEvent('backButtonClicked', handleBackButtonClick);
        } catch (e) {
            console.error("Initialization failed:", e);
        }
    });
    
    function navigate(targetPage, direction = 'forward') {
        const currentElem = pages[state.currentPage];
        const targetElem = pages[targetPage];
        
        if (!currentElem || !targetElem) {
            console.error(`Navigation error: page not found. Target: ${targetPage}`);
            return;
        }

        Object.values(pages).forEach(p => {
            p.classList.remove('center', 'left', 'right', 'active');
        });
        
        if (direction === 'forward') {
            currentElem.classList.add('left');
        } else {
            currentElem.classList.add('right');
        }
        targetElem.classList.add('center', 'active');

        state.previousPage = state.currentPage;
        state.currentPage = targetPage;
        updateUI();
    }

    function handleBackButtonClick() {
        if (state.currentPage === 'details') {
            navigate(state.previousPage || 'problems', 'backward');
        } else {
            const currentIndex = pageOrder.indexOf(state.currentPage);
            if (currentIndex > 0) {
                navigate(pageOrder[currentIndex - 1], 'backward');
            }
        }
    }

    function handleServiceClick(event) {
        const card = event.target.closest('.service-card');
        if (!card) return;
        
        const serviceId = card.dataset.serviceId;
        const infoButton = event.target.closest('.info-btn');

        if (infoButton) {
            tg.HapticFeedback.impactOccurred('light');
            renderDetailsPage(serviceId);
            navigate('details');
        } else {
            state.formData.problems.has(serviceId) ? state.formData.problems.delete(serviceId) : state.formData.problems.add(serviceId);
            tg.HapticFeedback.selectionChanged();
            card.classList.toggle('selected');
        }
        updateUI();
    }
    
    function handleInputChange(event) {
        const { id, value } = event.target;
        state.formData[id] = id === 'phone' ? formatPhoneNumber(value) : value;
        if (id === 'phone') event.target.value = state.formData.phone;
        updateUI();
    }

    function handleMainButtonClick() {
        console.log('üîò MainButton –Ω–∞–∂–∞—Ç–∞! –¢–µ–∫—É—â–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞:', state.currentPage);
        
        if (!validateCurrentPage()) {
            console.log('‚ùå –í–∞–ª–∏–¥–∞—Ü–∏—è –Ω–µ –ø—Ä–æ—à–ª–∞');
            tg.HapticFeedback.notificationOccurred('error');
            return;
        }

        const currentPage = state.currentPage;
        const currentIndex = pageOrder.indexOf(currentPage);

        if (currentIndex !== -1 && currentIndex < pageOrder.length - 1) {
            console.log('‚û°Ô∏è –ü–µ—Ä–µ—Ö–æ–¥–∏–º –Ω–∞ —Å–ª–µ–¥—É—é—â—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É');
            navigate(pageOrder[currentIndex + 1]);
        } else if (currentPage === 'summary') {
            console.log('üì§ –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –¥–∞–Ω–Ω—ã–µ!');
            sendData();
        } else if (currentPage === 'details') {
            console.log('‚¨ÖÔ∏è –í–æ–∑–≤—Ä–∞—â–∞–µ–º—Å—è –Ω–∞–∑–∞–¥');
            handleBackButtonClick();
        }
    }

    function sendData() {
        console.log('üöÄ sendData() –≤—ã–∑–≤–∞–Ω–∞!');
        console.log('üîç Telegram WebApp –æ–±—ä–µ–∫—Ç:', tg);
        console.log('üîç tg.sendData –¥–æ—Å—Ç—É–ø–µ–Ω:', typeof tg.sendData);
        console.log('üîç –°–æ—Å—Ç–æ—è–Ω–∏–µ —Ñ–æ—Ä–º—ã:', state.formData);
        
        tg.MainButton.showProgress();
        const { problems, ...rest } = state.formData;
        const dataToSend = { ...rest, problems: Array.from(problems).map(id => services.find(s => s.id === id).title) };
        
        console.log('üì§ –û—Ç–ø—Ä–∞–≤–ª—è—é –¥–∞–Ω–Ω—ã–µ:', dataToSend);
        console.log('üì§ JSON —Å—Ç—Ä–æ–∫–∞:', JSON.stringify(dataToSend));
        console.log('üì§ –î–ª–∏–Ω–∞ JSON:', JSON.stringify(dataToSend).length);
        
        // –î–ª—è MenuButton –∏—Å–ø–æ–ª—å–∑—É–µ–º fetch + answerWebAppQuery
        const payload = { queryId: tg.initDataUnsafe.query_id, payload: dataToSend };
        fetch('https://poetic-simplicity-production-60e7.up.railway.app/submit', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(payload)
        }).then(r => r.json()).then(res => {
            console.log('‚úÖ –°–µ—Ä–≤–µ—Ä –æ—Ç–≤–µ—Ç–∏–ª:', res);
        }).catch(err => {
            console.error('‚ùå –û—à–∏–±–∫–∞ fetch /submit:', err);
        });
        
        console.log('üéØ –ü–µ—Ä–µ—Ö–æ–¥–∏–º –∫ —ç–∫—Ä–∞–Ω—É —É—Å–ø–µ—Ö–∞...');
        renderSuccessActions();
        setTimeout(() => {
            console.log('üì± –ù–∞–≤–∏–≥–∞—Ü–∏—è –∫ success...');
            navigate('success');
        }, 500);
    }
    
    function updateUI() {
        tg.BackButton.isVisible = state.currentPage !== 'problems';
        
        let mb = { is_visible: false };
        if (state.currentPage === 'details') {
            mb = { text: '–ù–∞–∑–∞–¥ –∫ –≤—ã–±–æ—Ä—É', is_visible: true, is_active: true };
        } else if (pageOrder.includes(state.currentPage)) {
            mb = {
                text: state.currentPage === 'summary' ? '–û—Ç–ø—Ä–∞–≤–∏—Ç—å –∑–∞—è–≤–∫—É' : '–î–∞–ª–µ–µ',
                is_visible: true,
                is_active: validateCurrentPage()
            };
        }
        tg.MainButton.setParams(mb);

        if (state.currentPage === 'summary') renderSummary();
        lucide.createIcons();
    }

    function renderServiceCards() {
        const grid = document.getElementById('services-grid');
        grid.innerHTML = services.map(service => `
            <div class="service-card rounded-xl p-3 cursor-pointer relative" data-service-id="${service.id}">
                <div class="absolute top-1 right-1 info-btn p-2 rounded-full z-10">
                    <i data-lucide="info" class="w-4 h-4" style="color: var(--tg-theme-hint-color);"></i>
                </div>
                <div class="flex-grow flex flex-col items-center text-center pt-2">
                    <div class="icon-container w-12 h-12 rounded-full flex items-center justify-center mb-2">
                        <i data-lucide="${service.icon}" class="w-6 h-6"></i>
                    </div>
                    <span class="font-semibold text-sm">${service.title}</span>
                </div>
            </div>
        `).join('');
    }

    function renderDetailsPage(serviceId) {
        const service = services.find(s => s.id === serviceId);
        document.getElementById('details-content').innerHTML = `
            <div class="flex items-center mb-4">
                <div class="icon-container w-12 h-12 rounded-full flex items-center justify-center mr-4">
                    <i data-lucide="${service.icon}" class="w-6 h-6"></i>
                </div>
                <h1 class="text-2xl font-bold">${service.title}</h1>
            </div>
            <p class="text-md" style="color: var(--tg-theme-text-color);">${service.details}</p>
        `;
    }
    
    function renderSuccessActions() {
        const container = document.getElementById('success-actions');
        const service = services[0]; // Link to main page
        container.innerHTML = `
            <button id="view-cases-btn" class="font-bold py-3 px-6 rounded-lg w-full text-white" style="background-color: var(--tg-theme-button-color);">
                –ü–µ—Ä–µ–π—Ç–∏ –Ω–∞ —Å–∞–π—Ç
            </button>
        `;
        document.getElementById('view-cases-btn').onclick = () => tg.openLink(service.caseLink);
    }
    
    function renderSummary() {
        const container = document.getElementById('summary-container');
        const { problems, name, phone, description } = state.formData;
        const problemTitles = Array.from(problems).map(id => services.find(s => s.id === id).title);
        container.innerHTML = `
            <div class="p-4 rounded-lg bg-[var(--tg-theme-secondary-bg-color)]"><h3 class="font-bold mb-2">–ü—Ä–æ–±–ª–µ–º–∞</h3><p>${problemTitles.join(', ') || '–ù–µ —É–∫–∞–∑–∞–Ω–∞'}</p></div>
            <div class="p-4 rounded-lg bg-[var(--tg-theme-secondary-bg-color)]"><h3 class="font-bold mb-2">–ö–æ–Ω—Ç–∞–∫—Ç–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ</h3><p>–ò–º—è: ${name}</p><p>–¢–µ–ª–µ—Ñ–æ–Ω: ${phone}</p></div>
            <div class="p-4 rounded-lg bg-[var(--tg-theme-secondary-bg-color)]"><h3 class="font-bold mb-2">–û–ø–∏—Å–∞–Ω–∏–µ</h3><p class="whitespace-pre-wrap">${description || '–ù–µ —É–∫–∞–∑–∞–Ω–æ'}</p></div>`;
    }

    function validateCurrentPage() {
        if (state.currentPage === 'problems') return state.formData.problems.size > 0;
        if (state.currentPage === 'contacts') {
            const isNameValid = state.formData.name.trim().length > 1;
            const isPhoneValid = state.formData.phone.replace(/\D/g, '').length >= 11;
            document.getElementById('name').classList.toggle('invalid', !isNameValid);
            document.getElementById('phone').classList.toggle('invalid', !isPhoneValid);
            return isNameValid && isPhoneValid;
        }
        return true;
    }

    function formatPhoneNumber(value) {
        const x = value.replace(/\D/g, '').match(/(\d{0,1})(\d{0,3})(\d{0,3})(\d{0,2})(\d{0,2})/);
        if (!x) return '';
        return !x[2] ? (x[1] ? '+7' : '') : '+7 (' + x[2] + (x[3] ? ') ' + x[3] : '') + (x[4] ? '-' + x[4] : '') + (x[5] ? '-' + x[5] : '');
    }
</script>
</body>
</html>
